# Тестовое задание для Aikamsoft

<div align="justify">

## Общее описание

<p>Необходимо разработать приложение, предоставляющее сервис работы с данными в БД. Данный сервис на
основании входных параметров (аргументы командной строки), типа операции и входного файла извлекает необходимые данные
из БД и формирует результат обработки в выходной файл. 
<p> Все возможные ошибки должны быть обработаны и зафиксированы в
выходном файле.

## Общие требования

- Используемый стэк: Java 8, PostgreSQL, Maven;
- Входные параметры: тип операции, путь к входному файлу, путь к файлу результата;
- Формат файлов: JSON;
- Готовый проект должен быть загружен на github. Желательно производить декомпозицию работ и фиксировать отдельными
  коммитами;
- Готовый проект должен содержать готовый набор данных для
  тестирования: [дамп БД](src/main/resources/db_migration/db_all.sql), [входные файлы](src/main/resources);
- Готовый проект должен включать [инструкцию по сборке/запуску](#Инструкция);

### Инструкция

#### Сборка

```bash
mvn compile
```

```bash
mvn package
```

#### Запуск

**SEARCH REQUEST**

```bash
java -jar aikamsoft-test-task.jar search input.json output.json
```

**SCAN REQUEST**

```bash
java -jar aikamsoft-test-task.jar search input.json output.json
```

## Структура данных

- Покупатели (имя, фамилия)
- Товары (название, цена)
- Покупки (покупатель, товар, дата покупки)

## Типы и описание операций

Операции определяются по входному параметру

### Поиск покупателей по критериям (search)

Во входном файле передаётся список критериев для поиска покупателей. Результат операции — списки покупателей для каждого
критерия из запроса. Порядок списков такой же как в запросе, порядок покупателей в списке произвольный.

Критерии:

- Фамилия — поиск покупателей с этой фамилией;
- Название товара и число раз — поиск покупателей, купивших этот товар не менее, чем указанное число раз;
- Минимальная и максимальная стоимость всех покупок — поиск покупателей, у которых общая стоимость всех покупок за всё
  время попадает в интервал;
- Число пассивных покупателей — поиск покупателей, купивших меньше всего товаров. Возвращается не более, чем указанное
  число покупателей.

**Важно**: Критерии могут повторяться, например, два раза критерий с lastName.

#### Пример:

**INPUT**

```json
{
  "criteria": [
    {
      "lastName": "Иванов"
    },
    {
      "productName": "Минеральная вода",
      "minTimes": 5
    },
    {
      "minExpenses": 112,
      "maxExpenses": 4000
    },
    {
      "badCustomers": 3
    }
  ]
}
```

**OUTPUT**

```json
{
  "type": "search",
  "results": [
    {
      "criteria": {
        "lastName": "Иванов"
      },
      "results": [
        {
          "lastName": "Иванов",
          "firstName": "Антон"
        },
        {
          "lastName": "Иванов",
          "firstName": "Николай"
        }
      ]
    },
    {
      "criteria": {
        "productName": "Минеральная вода",
        "minTimes": 5
      },
      "results": [
        {
          "lastName": "Петров",
          "firstName": "Валентин"
        }
      ]
    }
  ]
}
```

### Статистика за период (stat)

Во входном файле передаётся интервал дат сбора статистики. Результат операции — статистика по покупателям за период из
двух дат, включительно, без выходных Необходимые данные для статистики на примере результата:

**INPUT**

```json
{
  "startDate": "2020-01-14",
  "endDate": "2020-01-26"
}
```

**OUTPUT**

```json
{
  "type": "stat",
  "totalDays": 9,
  "customers": [
    {
      "name": "Иванов Антон",
      "purchases": [
        {
          "name": "Хлеб",
          "expenses": 540
        },
        {
          "name": "Сметана",
          "expenses": 517
        },
        {
          "name": "Колбаса",
          "expenses": 332
        }
      ],
      "totalExpenses": 4100
    },
    {
      "name": "Петров Валентин",
      "purchases": [
        {
          "name": "Сыр",
          "expenses": 470
        },
        {
          "name": "Хлеб",
          "expenses": 300
        },
        {
          "name": "Минеральная вода",
          "expenses": 120
        }
      ],
      "totalExpenses": 3700
    }
  ],
  "totalExpenses": 19920,
  "avgExpenses": 3455.72
}
```

### В случае возникновения ошибки, при выполнении любой операции — фиксируется результат:

**OUTPUT**

```json
{
  "type": "error",
  "message": "Неправильный формат даты"
}
```

</div>